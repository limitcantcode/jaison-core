# J.A.I.son

[安装](#安装) | [连接至Twitch](#连接至Twitc) | [自定义回复](#自定义回复) | [自定义声音](#自定义声音) | [配置](#配置) | [运行](#运行)

## 安装
该项目用Python v3.12.18编写。我在一台带有英特尔CPU和RTX4070的电脑上用WSL2 Ubuntu运行，系统为Windows。暂时不支持运行在非英伟达显卡的环境里。

### 1.安装前的准备

**推荐你使用CONDA构建一个虚拟环境以避免兼容性问题**
1. 安装 [CUDA](https://developer.nvidia.com/cuda-toolkit)
2. 安装 [conda](https://docs.conda.io/projects/conda/en/stable/user-guide/install/index.html) 以管理虚拟环境 (推荐使用Miniconda)

### 2.设置插件
你可以在 [Discord](https://discord.gg/Z8yyEzHsYM) 上或我的Github上找到各种插件和应用程序。这些插件和应用程序都是社区项目，也就是说每个人都可以制作和上传。每一个插件都有自己的使用方法，所以记得看开发文档！

如果你要使用这些插件，你需要在配置文件里列出可用的插件 (默认是 `./configs/plugins/example.yaml`)。 Endpoint适用于在运行此项目之前部署插件的情况（节省开发时间，可以在另一台机器上部署，并且在此项目停止运行后不会关闭），或者您可以指定目录的路径（此项目将自动启动，但需要一些时间加载，并且只能在同一台机器上部署）

你需要 STT（声音转文字）,T2T（大语言模型）,TTSG和TTSC（语言生成） 组件以确保该项目正常运行,这里有一些我制作的：


- [STT:本地运行的 OpenAI Whisper](https://github.com/limitcantcode/stt-openai-whisper-lcc-comp) (推荐)
- [T2T:GPT OpenAI API](https://github.com/limitcantcode/t2t-openai-lcc-comp) (推荐)
- [T2T:本地运行大模型](https://github.com/limitcantcode/t2t-unsloth-lcc-comp)
- [TTSG:OpenAI API](https://github.com/limitcantcode/ttsg-openai-lcc-comp) (推荐)
- [TTSG:Speech Synthesis](https://github.com/limitcantcode/ttsg-pytts-lcc-comp)
- [TTSC:RVC Project](https://github.com/limitcantcode/ttsc-rvc-proj-lcc-comp)
- [TTSC:No Changer](https://github.com/limitcantcode/ttsc-no-changer-lcc-comp) (推荐)

要将此项目与应用程序连接，只需在JAIson-core运行后单独运行这些应用程序。编写文档时，JAIson-core不管理这些应用程序。以下是我制作的一些应用程序：

- [Discord聊天机器人](https://github.com/limitcantcode/app-jaison-discord-lcc)
- [Twitch直播](https://github.com/limitcantcode/app-jaison-twitch-lcc)
- [VTube Studio热键控制](https://github.com/limitcantcode/app-jaison-vts-hotkeys-lcc)

## 3.配置
JAIson-core的配置文件在 `./configs/jaison` 。以下是各值的描述：

- prompt_default_file: (str) `./prompts/production` 中的提示文件名。必须在此文件中，且仅为文件名。
- prompt_params: (dict) 提示中变量到其实际值的映射（查看提示文件以了解存在的变量）
- prompt_name_translation_file: (str) `./configs/translations` 中的名称翻译文件名。必须在此文件中，且仅为文件名。
- prompt_convo_retention_length: (int) 为生成T2T响应而保留的主要对话历史的长度
- plugins_config_file: (str) `./configs/plugins` 下的文件名。必须在此文件中，且仅为文件名。
- active_plugins: (List[str]) 激活的插件列表。直到编写时，每种类型只能有一个。应为该组件的 `metadata.yaml` 里的ID。
- web_port: (int) 用作应用程序API和Websocket服务器的端口

您还可以通过 `./configs/translations` 中的配置来添加名称别名。

### 4.配置环境
推荐使用CONDA虚拟环境，因为下面的内容也是关于CONDA的:

创建并激活环境。按以下顺序安装依赖项。先从[这里](https://pytorch.org/get-started/locally/)安装合适的Pytorch。
```bash
conda create -n jaison-core python=3.12 ffmpeg cudatoolkit -c pytorch -y
conda activate jaison-core
pip install -r requirements.txt
```

## 运行
### 1.确保依赖应用程序正在运行

### 2.确认使用正确的环境
```bash
conda activate jaison-core
```

### 3.启动！
只需要执行这一行代码就启动了
```bash
python ./src/main.py --config=config.json
```

如果要得到所有的选项列表，运行以下命令：
```bash
python ./src/main.py --help
```

## 日志记录
日志默认存储在 `./logs` 。Changing the log directory (an option when starting the project) requires the new directory to subfolders `sys`, `dialog`, and `response`.

`sys` contains system logs for each of the main application, VTube studio plugins, and the Discord bot. Only certain logs are sent to the console as well, but all logs are sent to files (except for those generated by dependencies such as Discord.py).

`dialog` contains the entire conversation history in the same format used for generating T2T responses. This is useful for creating new datasets and monitoring conversations.

`response` contains entries immediately usable to train T2T AI models. These contain the time, system prompt, user prompt, and generated response for every response made by the T2T model in use. This is useful for cherrypicking favorable responses to retrain the model on.